<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Monadicons — Create your personal icon</title>
  <meta name="description" content="Create unique, customizable SVG/PNG avatars using DiceBear or Jdenticon. No design skills required — works offline as a PWA." />
  <meta name="theme-color" content="#7C3AED" />
  <link rel="stylesheet" href="styles.css">
  <script src="https://cdn.jsdelivr.net/npm/jdenticon@3.2.0/dist/jdenticon.min.js"></script>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>Monadicons</h1>
      <p>Create unique avatars instantly — DiceBear + Jdenticon, fully offline.</p>
    </header>

    <main class="card">
      <section class="controls">
        <label for="seed">Seed / Name</label>
        <input id="seed" type="text" placeholder="e.g., aurora" autocomplete="off" />

        <label for="style">Style</label>
        <select id="style">
          <option value="adventurer">Adventurer (DiceBear)</option>
          <option value="avataaars">Avataaars (DiceBear)</option>
          <option value="pixel-art-neutral">Pixel (DiceBear)</option>
          <option value="identicon">Identicon (DiceBear)</option>
          <option value="micah">Micah (DiceBear)</option>
          <option value="jdenticon">Jdenticon (local)</option>
        </select>

        <label for="bgType">Background Type</label>
        <select id="bgType">
          <option value="transparent">Transparent</option>
          <option value="solid">Solid</option>
        </select>

        <label for="bgColor">Background Color</label>
        <input id="bgColor" type="color" value="#ffffff" />

        <label for="size">Size (px)</label>
        <input id="size" type="number" value="512" min="64" max="1024" />

        <button id="generate" class="primary">Generate</button>
        <div class="action-buttons">
          <button id="downloadSvg" disabled>Download SVG</button>
          <button id="downloadPng" disabled>Download PNG</button>
          <button id="copyEmbed" disabled>Copy Embed</button>
          <button id="share" disabled>Share</button>
        </div>
      </section>

      <aside class="preview">
        <h4>Preview</h4>
        <div id="previewBox" class="preview-box">Select options and click Generate</div>
        <div id="previewMeta" class="meta">Style: — • Seed: — • Size: —</div>
      </aside>
    </main>

    <footer>
      Avatars powered by 
      <a href="https://www.dicebear.com" target="_blank">DiceBear</a> and 
      <a href="https://jdenticon.com" target="_blank">Jdenticon</a> — MIT licensed
    </footer>
  </div>

  <script>
    const seedInput = document.getElementById('seed');
    const styleSelect = document.getElementById('style');
    const bgTypeSelect = document.getElementById('bgType');
    const bgColorInput = document.getElementById('bgColor');
    const sizeInput = document.getElementById('size');

    const generateBtn = document.getElementById('generate');
    const downloadSvgBtn = document.getElementById('downloadSvg');
    const downloadPngBtn = document.getElementById('downloadPng');
    const copyEmbedBtn = document.getElementById('copyEmbed');
    const shareBtn = document.getElementById('share');

    const previewBox = document.getElementById('previewBox');
    const previewMeta = document.getElementById('previewMeta');

    let currentSvg = '';
    let currentSeed = '';
    let currentStyle = '';
    let currentSize = 512;

    function enableActions() {
      downloadSvgBtn.disabled = false;
      downloadPngBtn.disabled = false;
      copyEmbedBtn.disabled = false;
      shareBtn.disabled = false;
    }

    generateBtn.addEventListener('click', async () => {
      currentSeed = seedInput.value.trim() || 'anon';
      currentStyle = styleSelect.value;
      currentSize = parseInt(sizeInput.value, 10) || 512;

      let svg = '';
      if (currentStyle === 'jdenticon') {
        svg = jdenticon.toSvg(currentSeed, currentSize);
      } else {
        const url = `https://api.dicebear.com/7.x/${currentStyle}/svg?seed=${encodeURIComponent(currentSeed)}&size=${currentSize}`;
        svg = await fetch(url).then(r => r.text());
      }
      currentSvg = svg;

      // Apply background if solid
      const bgType = bgTypeSelect.value;
      const bgColor = bgColorInput.value;
      let wrappedSvg = svg;
      if (bgType === 'solid') {
        wrappedSvg = svg.replace('<svg', `<svg style="background:${bgColor}"`);
      }

      // Update preview
      previewBox.innerHTML = wrappedSvg;
      previewMeta.textContent = `Style: ${currentStyle} • Seed: ${currentSeed} • Size: ${currentSize}px`;
      enableActions();
    });

    downloadSvgBtn.addEventListener('click', () => {
      const blob = new Blob([currentSvg], { type: 'image/svg+xml' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `${currentSeed}-${currentStyle}.svg`;
      a.click();
      URL.revokeObjectURL(url);
    });

    downloadPngBtn.addEventListener('click', () => {
      const img = new Image();
      const svgBlob = new Blob([currentSvg], { type: 'image/svg+xml' });
      const url = URL.createObjectURL(svgBlob);
      img.onload = () => {
        const canvas = document.createElement('canvas');
        canvas.width = currentSize;
        canvas.height = currentSize;
        const ctx = canvas.getContext('2d');
        ctx.fillStyle = bgTypeSelect.value === 'solid' ? bgColorInput.value : 'transparent';
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        ctx.drawImage(img, 0, 0, currentSize, currentSize);
        canvas.toBlob((blob) => {
          const a = document.createElement('a');
          a.href = URL.createObjectURL(blob);
          a.download = `${currentSeed}-${currentStyle}.png`;
          a.click();
        });
        URL.revokeObjectURL(url);
      };
      img.src = url;
    });

    copyEmbedBtn.addEventListener('click', () => {
      const code = `<img src="data:image/svg+xml;utf8,${encodeURIComponent(currentSvg)}" width="${currentSize}" height="${currentSize}" alt="avatar"/>`;
      navigator.clipboard.writeText(code);
      alert('Embed code copied!');
    });

    shareBtn.addEventListener('click', () => {
      const params = new URLSearchParams({
        seed: currentSeed,
        style: currentStyle,
        size: currentSize,
        bg: bgTypeSelect.value,
        color: bgColorInput.value
      });
      const link = `${location.origin}${location.pathname}?${params.toString()}`;
      navigator.clipboard.writeText(link);
      alert('Link copied to clipboard!');
    });

    window.addEventListener('DOMContentLoaded', () => {
      const urlParams = new URLSearchParams(window.location.search);
      if (urlParams.has('seed')) {
        seedInput.value = urlParams.get('seed');
        styleSelect.value = urlParams.get('style') || 'adventurer';
        sizeInput.value = urlParams.get('size') || '512';
        bgTypeSelect.value = urlParams.get('bg') || 'transparent';
        bgColorInput.value = urlParams.get('color') || '#ffffff';
        generateBtn.click();
      }
    });
  </script>
</body>
</html>
